pipeline {
    agent any
    
    stages {
        // 1. 코드 체크아웃 단계
        stage('Checkout Code') {
            steps {
                script {
                    echo "🔍 저장소에서 코드를 가져오는 중..."
                    checkout([$class: 'GitSCM', 
                            branches: [[name: '*/dev-be']], 
                            extensions: [], 
                            userRemoteConfigs: [[url: 'https://lab.ssafy.com/s12-final/S12P31A106.git']]
                            // credentialsId: 'gitlab-token-jenkins' // 위에서 등록한 ID
                    ])
                }
            }
        }
        
        // 2. 빌드 단계 (예시: 백엔드)
        stage('Build Backend') {
            steps {
                script {
                    echo "🏗️ 백엔드 빌드 시작"
                    dir('BE') {
                        sh 'docker-compose build'
                    }
                }
            }
        }
        
        // 3. 테스트 단계 (예시)
        stage('Run Tests') {
            steps {
                script {
                    echo "🧪 테스트 실행 중..."
                    // 실제 테스트 명령어는 프로젝트에 맞게 수정
                    sh 'echo "테스트 실행 가정"'
                }
            }
        }
        
        // 4. 배포 단계
        stage('Deploy') {
            steps {
                script {
                    echo "🚀 배포 시작"
                    dir('Infra') {
                        sh 'docker-compose up -d --build'
                    }
                }
            }
        }
    }
    
    post {
        success {
            echo "🎉 파이프라인이 성공적으로 완료되었습니다!"
            // 성공 시 알림 설정 (예: 슬랙, 이메일)
        }
        failure {
            echo "❌ 파이프라인 실행 중 오류 발생!"
            // 실패 시 알림 설정
        }
        always {
            echo "📊 빌드 결과 리포트 생성..."
            // 정리 작업 또는 리포트 생성
        }
    }
}
