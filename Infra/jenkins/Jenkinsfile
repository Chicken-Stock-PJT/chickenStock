pipeline {
    agent any
    
    stages {
        // 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ ë‹¨ê³„
        stage('Checkout Code') {
            steps {
                script {
                    echo "ğŸ” ì €ì¥ì†Œì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘..."
                    checkout([$class: 'GitSCM', 
                            branches: [[name: '*/dev-be']], 
                            extensions: [], 
                            userRemoteConfigs: [[url: 'https://lab.ssafy.com/s12-final/S12P31A106.git']]
                            // credentialsId: 'gitlab-token-jenkins' // ìœ„ì—ì„œ ë“±ë¡í•œ ID
                    ])
                }
            }
        }
        
        // 2. ë¹Œë“œ ë‹¨ê³„ (ì˜ˆì‹œ: ë°±ì—”ë“œ)
        stage('Build Backend') {
            steps {
                script {
                    echo "ğŸ—ï¸ ë°±ì—”ë“œ ë¹Œë“œ ì‹œì‘"
                    dir('BE') {
                        sh 'docker-compose build'
                    }
                }
            }
        }
        
        // 3. í…ŒìŠ¤íŠ¸ ë‹¨ê³„ (ì˜ˆì‹œ)
        stage('Run Tests') {
            steps {
                script {
                    echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
                    // ì‹¤ì œ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì •
                    sh 'echo "í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ì •"'
                }
            }
        }
        
        // 4. ë°°í¬ ë‹¨ê³„
        stage('Deploy') {
            steps {
                script {
                    echo "ğŸš€ ë°°í¬ ì‹œì‘"
                    dir('Infra') {
                        sh 'docker-compose up -d --build'
                    }
                }
            }
        }
    }
    
    post {
        success {
            echo "ğŸ‰ íŒŒì´í”„ë¼ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            // ì„±ê³µ ì‹œ ì•Œë¦¼ ì„¤ì • (ì˜ˆ: ìŠ¬ë™, ì´ë©”ì¼)
        }
        failure {
            echo "âŒ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!"
            // ì‹¤íŒ¨ ì‹œ ì•Œë¦¼ ì„¤ì •
        }
        always {
            echo "ğŸ“Š ë¹Œë“œ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±..."
            // ì •ë¦¬ ì‘ì—… ë˜ëŠ” ë¦¬í¬íŠ¸ ìƒì„±
        }
    }
}
